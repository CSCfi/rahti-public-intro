# Rahti

<!-- .slide: data-background="img/topic_background.png" -->

---

## CSC clouds

* <!-- .element: class="fragment" data-fragment-index="0" --> Infrastructure-as-a-service (c/ePouta) - central concept: Virtual machines
* <!-- .element: class="fragment" data-fragment-index="1" --> Platform-as-a-service (Rahti) - central concept: Containerized applications
* <!-- .element: class="fragment" data-fragment-index="2" --> Same end goal: enable users to run their own software in the cloud

---

## Containers

* Standardize software deployment
* Build once, run anywhere
* Everything needed to run an app in a single package
* Enabler for standardized infrastructure

---

## What is Rahti?

* A new service from CSC
* Container cloud platform based on **OKD 3.11** - Red Hat's open source distribution of **Kubernetes**
* OKD is the upstream version of **OpenShift**
* Run applications packaged as **containers**
* 1200+ Intel Skylake CPU cores and 5Tb+ RAM
* Upcoming GPU capacity...
* Currently in **open beta**
* **Production in early 2020**

---

## Key features

* Multi tenant 
* Integrated docker registry
* Source-to-image (S2I)
* BuildConfigs
* Auto scaling
* Application catalog
* Easy default TLS & URL for app

===

# Workflow example

<!-- .slide: data-background="img/topic_background.png" -->

---

<!-- .slide: data-transition="none" -->
![Container orchestration workflow](img/container_orchestration_stage0.png)

---

<!-- .slide: data-transition="none" -->
![Container orchestration workflow](img/container_orchestration_stage1.png)

---

<!-- .slide: data-transition="none" -->
![Container orchestration workflow](img/container_orchestration_stage2.png)

---

<!-- .slide: data-transition="none" -->
![Container orchestration workflow](img/container_orchestration_stage3.png)

---

<!-- .slide: data-transition="none" -->
![Container orchestration workflow](img/container_orchestration_stage4.png)

===

# Why Kubernetes?

<!-- .slide: data-background="img/topic_background.png" -->

---

## Standard

* The de facto standard for container orchestration
* Targeted by software distributors
* Can hire people with Kubernetes skills

---

## Wide support

* Open source, hosted by a foundation (CNCF)
* Backing from tech giants, including:
  * Google
  * Red Hat
  * Microsoft
  * Cisco
  * Oracle
  * AWS

---

## Large ecosystem

* <a href="http://l.cncf.io" data-preview-link>CNCF Cloud Native Landscape (https://l.cncf.io)</a>
* <a href="https://kubernetes.io/case-studies/" data-preview-link>Kubernetes Case Studies</a>
---

## Supported by all major cloud providers

* "The K stands for Kubernetes" - Kubernetes on the big three cloud platforms
  * Amazon EKS
  * Microsoft Azure AKS
  * Google GKE

---

## Sites that use Kubernetes

![New York Times](img/ny_times_logo.png)

![GitHub](img/github_logo.png)

![Spotify](img/spotify_logo.png)

===

# Development of Rahti

<!-- .slide: data-background="img/topic_background.png" -->

---

## Tools

* Ansible for deployment & maintenance
* GIT repositories:
  * [pouta-openshift-cluster](https://github.com/CSCfi/pouta-openshift-cluster): Infrastructure provisioning & 
  CSC addons.
  * openshift-environments: Private repo for hosting the Ansible dynamic inventory and secrets.
  * [openshift-ansible](https://github.com/openshift/openshift-ansible): Red hat's upstream OKD deployment code.
* Deployment container in order operations more convenient.
* CI/CD pipeline based on Gitlab-CI

---

## Limitations

* Since it's a large scale system...
  * number of pods per node
  * network throughput (LB nodes and SDN)
* Prometheus overloaded (... and the metrics server as a consequence)
* The Docker daemon hangs on several nodes
  * due to the huge amount of logs generated by the pods on a single node
* CPU load for SSL termination on LB nodes (Ingress)
* OpenStack limitations (Single router intake)

---

## GPUs

* Based on OpenShift's device plugin
  * -> exposes local "special" devices through a local socket
  * https://github.com/NVIDIA/k8s-device-plugin
* Custom SELinux module for GPU nodes
* Nvidia's OCI prestart hook:
  * for enabling GPU enabled containers
* Completely transparent to end users with multiple GPU support!

---

## Upcoming challenges

* Scalable network architecture
  * Multiple active load balancers with more capacity
  * 2-3 OpenStack routers for traffic intake
  * OpenStack's provider networks?
* OpenShift 4 upgrade

===

# How to start using Rahti?

<!-- .slide: data-background="img/topic_background.png" -->

---

## More information

* [The Rahti main page](https://rahti.csc.fi/) for end user documentation
  * Like cPouta and ePouta, you need a CSC computing project to access Rahti
  * No cost for you when you use Rahti for open research and education
  * [Instructions for getting access](https://rahti.csc.fi/introduction/access/)
  * [MyCSC customer portal](https://my.csc.fi/)
* [rahti-support@csc.fi](mailto:rahti-support@csc.fi) for support
* [rahti-team@postit.csc.fi](mailto:rahti-team@postit.csc.fi) to contact the team

---

## OpenShift vs Kubernetes

* Why is it challenging to deploy apps on OpenShift compared to Kubernetes?
